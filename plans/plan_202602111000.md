# Plan: HAC Go Reference Middleware

## Context

HAC (HTTP Agent Context) is a spec for enriching HTTP API responses with agent-relevant metadata via content negotiation (`Accept: application/vnd.hac+json`). Step 1 (the spec) is complete. This plan implements **step 2 from PLAN.md**: a reference Go middleware library that API providers can drop into any `net/http`-compatible server.

## Package Structure

All code lives in a new `go-hac/` directory at the repo root. Single flat package (`package hac`), zero external dependencies (stdlib only).

```
go-hac/
  go.mod                    # module github.com/httpagentcontext/go-hac
  doc.go                    # Package doc comment
  hac.go                    # Core types: Action, Safety, Field, Cost, enums, constants
  media.go                  # Accept header parser with quality factor support
  context.go                # Request context helpers (IsHACRequested)
  config.go                 # Registry + RouteBuilder (declarative route metadata)
  envelope.go               # Success + error envelope construction
  middleware.go             # The http.Handler middleware + responseRecorder
  discovery.go              # Discovery handler + AutoDiscovery helper
  hac_test.go               # Core type tests
  media_test.go             # Accept header parsing tests
  config_test.go            # Registry/builder tests
  envelope_test.go          # Envelope construction tests
  middleware_test.go         # Integration tests (table-driven)
  discovery_test.go          # Discovery handler tests
  example_test.go            # Runnable examples for godoc
```

## Implementation Sequence

1. `hac.go` — types, constants, enums
2. `media.go` — Accept header parser
3. `context.go` — context key + IsHACRequested
4. `config.go` — Registry, RouteBuilder, PathResolver
5. `envelope.go` — buildSuccessEnvelope, buildErrorEnvelope
6. `middleware.go` — Middleware(), responseRecorder, Options
7. `discovery.go` — Discovery, AutoDiscovery
8. `doc.go` + `example_test.go` — documentation
9. Tests alongside each file

## Verification

1. `cd go-hac && go test ./...` — all tests pass
2. `go vet ./...` — no issues
